name: Test Conda environment creation

on: [push]

jobs:
  test-env:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.11
      uses: actions/setup-python@v3
      with:
        python-version: '3.11'

    - name: Add conda to system path
      shell: bash
      run: |
        # $CONDA is an environment variable pointing to the root of the miniconda directory
        echo $CONDA/bin >> $GITHUB_PATH

    - name: Create conda environment
      shell: bash
      run: |
        conda env create -f environment_core.yml -q -v
        conda init bash

    - name: Check PyHC packages can be imported
      shell: bash
      run: |
        conda activate pyhc-core
        python -c "import hapiclient"
        python -c "import plasmapy"
        python -c "import pysat"
        python -c "import pyspedas"
        python -c "import spacepy"
        python -c "import sunpy"
